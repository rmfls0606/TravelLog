<svg width="1200" height="560" viewBox="0 0 1200 560" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: 700 28px -apple-system, BlinkMacSystemFont, Segoe UI, Arial, sans-serif; fill: #0f172a; }
      .sub { font: 500 15px -apple-system, BlinkMacSystemFont, Segoe UI, Arial, sans-serif; fill: #334155; }
      .h { font: 700 16px -apple-system, BlinkMacSystemFont, Segoe UI, Arial, sans-serif; fill: #0f172a; }
      .b { font: 500 14px -apple-system, BlinkMacSystemFont, Segoe UI, Arial, sans-serif; fill: #334155; }
      .s { font: 500 12px -apple-system, BlinkMacSystemFont, Segoe UI, Arial, sans-serif; fill: #475569; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#64748b"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#2563eb"/>
    </marker>
  </defs>

  <rect width="1200" height="560" fill="#f8fafc"/>
  <text x="32" y="48" class="title">Audio Session Data Flow</text>
  <text x="32" y="74" class="sub">단일 오디오 세션 제어와 인터럽션 대응 흐름</text>

  <rect x="32" y="100" width="1136" height="430" rx="16" fill="#ffffff" stroke="#e2e8f0"/>

  <rect x="64" y="140" width="220" height="76" rx="12" fill="#eff6ff" stroke="#bfdbfe"/>
  <text x="84" y="170" class="h">사용자 액션</text>
  <text x="84" y="192" class="b">녹음 시작 / 재생 시작</text>

  <rect x="334" y="140" width="250" height="76" rx="12" fill="#eef2ff" stroke="#c7d2fe"/>
  <text x="354" y="170" class="h">AudioCoordinator</text>
  <text x="354" y="192" class="b">단일 활성 블록 제어</text>

  <rect x="634" y="140" width="230" height="76" rx="12" fill="#f8fafc" stroke="#cbd5e1"/>
  <text x="654" y="170" class="h">사전 검증</text>
  <text x="654" y="192" class="b">권한/하드웨어 상태 확인</text>

  <rect x="914" y="140" width="220" height="76" rx="12" fill="#f0fdf4" stroke="#bbf7d0"/>
  <text x="934" y="170" class="h">세션 활성화</text>
  <text x="934" y="192" class="b">필요 시점에만 활성화</text>

  <line x1="284" y1="178" x2="334" y2="178" stroke="#64748b" stroke-width="2.2" marker-end="url(#arrow)"/>
  <line x1="584" y1="178" x2="634" y2="178" stroke="#64748b" stroke-width="2.2" marker-end="url(#arrow)"/>
  <line x1="864" y1="178" x2="914" y2="178" stroke="#64748b" stroke-width="2.2" marker-end="url(#arrow)"/>

  <rect x="64" y="270" width="250" height="94" rx="12" fill="#fff7ed" stroke="#fed7aa"/>
  <text x="84" y="300" class="h">Recorder / Player</text>
  <text x="84" y="322" class="b">실시간 파형, 타이머 갱신</text>
  <text x="84" y="344" class="b">AAC/Mono 저장 정책</text>

  <rect x="374" y="270" width="250" height="94" rx="12" fill="#fefce8" stroke="#fde68a"/>
  <text x="394" y="300" class="h">상태 동기화</text>
  <text x="394" y="322" class="b">UI 슬라이더/버튼 갱신</text>
  <text x="394" y="344" class="b">1초 미만 저장 차단</text>

  <rect x="684" y="270" width="250" height="94" rx="12" fill="#ecfeff" stroke="#a5f3fc"/>
  <text x="704" y="300" class="h">파일 저장</text>
  <text x="704" y="322" class="b">로컬 파일 경로 기록</text>
  <text x="704" y="344" class="b">블록 데이터와 연결</text>

  <rect x="944" y="270" width="190" height="94" rx="12" fill="#f0f9ff" stroke="#bae6fd"/>
  <text x="964" y="300" class="h">종료 처리</text>
  <text x="964" y="322" class="b">세션 비활성화</text>
  <text x="964" y="344" class="b">외부 오디오 복원</text>

  <line x1="314" y1="317" x2="374" y2="317" stroke="#64748b" stroke-width="2.2" marker-end="url(#arrow)"/>
  <line x1="624" y1="317" x2="684" y2="317" stroke="#64748b" stroke-width="2.2" marker-end="url(#arrow)"/>
  <line x1="934" y1="317" x2="944" y2="317" stroke="#64748b" stroke-width="2.2" marker-end="url(#arrow)"/>

  <rect x="64" y="402" width="1070" height="96" rx="14" fill="#f8fafc" stroke="#cbd5e1"/>
  <text x="84" y="430" class="h">이벤트 기반 안전 중지 경로</text>
  <text x="84" y="452" class="b">전화, 인터럽션, 백그라운드, 이어폰 분리 발생 시 stopAll()로 안전 중지</text>
  <text x="84" y="474" class="s">재시작은 자동이 아닌 사용자 명시 액션으로만 수행</text>

  <line x1="220" y1="364" x2="220" y2="402" stroke="#2563eb" stroke-width="2.2" marker-end="url(#arrowBlue)"/>
  <line x1="494" y1="364" x2="494" y2="402" stroke="#2563eb" stroke-width="2.2" marker-end="url(#arrowBlue)"/>
  <line x1="804" y1="364" x2="804" y2="402" stroke="#2563eb" stroke-width="2.2" marker-end="url(#arrowBlue)"/>
  <line x1="1036" y1="364" x2="1036" y2="402" stroke="#2563eb" stroke-width="2.2" marker-end="url(#arrowBlue)"/>
</svg>
